!function(){"use strict";window.wp}(jQuery);var TmsmAquatonicCourseApp=TmsmAquatonicCourseApp||{};!function($){"use strict";var TmsmAquatonicCourseBaseCollection={url:TmsmAquatonicCourseApp.data.ajaxurl,action:"tmsm-aquatonic-course-booking-weekday",sync:function(method,object,options){return void 0===options.data&&(options.data={}),options.data.nonce=TmsmAquatonicCourseApp.data.nonce,options.data.action_type=method,void 0===options.data.action&&void 0!==this.action&&(options.data.action=this.action),Backbone.sync(method,object,options)}},TmsmAquatonicCourseBaseModel=Backbone.Model.extend(_.defaults({},TmsmAquatonicCourseBaseCollection)),TmsmAquatonicCourseBaseCollection=Backbone.Collection.extend(_.defaults({},TmsmAquatonicCourseBaseCollection));TmsmAquatonicCourseApp.TimeModel=TmsmAquatonicCourseBaseModel.extend({action:"tmsm-aquatonic-course-booking-times",defaults:{date:null,hour:null,minute:null,priority:null,capacity:null,hourminutes:null,index:null}}),TmsmAquatonicCourseApp.TimesCollection=TmsmAquatonicCourseBaseCollection.extend({action:"tmsm-aquatonic-course-booking-times",model:TmsmAquatonicCourseApp.TimeModel}),TmsmAquatonicCourseApp.TimesListView=Backbone.View.extend({el:"#tmsm-aquatonic-course-booking-times-container",selectedValue:null,listElement:"#tmsm-aquatonic-course-booking-times-list",loadingElement:"#tmsm-aquatonic-course-booking-times-loading",errorElement:"#tmsm-aquatonic-course-booking-times-error",anotherDateElement:"#tmsm-aquatonic-course-booking-times-anotherdate",selectButtons:".tmsm-aquatonic-course-booking-time-button",cancelButtons:".tmsm-aquatonic-course-booking-time-change-label",initialize:function(){this.hide(),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquatonic-course-booking-time-button":"selectTime","click .tmsm-aquatonic-course-booking-time-change-label":"cancelTime","click #tmsm-aquatonic-course-booking-times-anotherdate":"changeDate","click .previous":"previous","click .next":"next"},loading:function(){$(this.errorElement).hide(),$(this.loadingElement).show(),$(this.listElement).hide()},loaded:function(){$(this.loadingElement).hide(),$(this.listElement).show()},render:function(){var $list=this.$(this.listElement).empty().val("");$list.hide();var i=0;return this.collection.each(function(model){1===++i&&$('.tmsm-aquatonic-course-booking-weekday-times[data-date="'+model.attributes.date+'"]').empty().append("<option>"+TmsmAquatonicCourseApp.i18n.pickatimeslot+"</option>");var item=new TmsmAquatonicCourseApp.TimesListItemView({model:model});0<$('.tmsm-aquatonic-course-booking-weekday-times[data-date="'+model.attributes.date+'"]').length&&$('.tmsm-aquatonic-course-booking-weekday-times[data-date="'+model.attributes.date+'"]').append(item.render().el.outerHTML),$list.append(item.render().$el)},this),this.loaded(),0===this.collection.length?$(this.errorElement).show():$(this.errorElement).hide(),this},selectTime:function(event){event.preventDefault(),this.selectedValue=$(event.target).data("hourminutes"),$(this.selectButtons).hide().removeClass("disabled").removeClass("selected").addClass("not-selected"),$(event.target).show().addClass("selected").removeClass("not-selected").find(".tmsm-aquatonic-course-booking-time").addClass("disabled"),TmsmAquatonicCourseApp.selectedData.set("hourminutes",this.selectedValue)},selectTimeWithSelect:function(event){},cancelTime:function(event){event.preventDefault(),$(this.selectButtons).show().removeClass("disabled").removeClass("selected").addClass("not-selected"),this.selectedValue=null,TmsmAquatonicCourseApp.selectedData.set("hourminutes",null)},changeDate:function(event){event.preventDefault(),TmsmAquatonicCourseApp.dateList.reset(),TmsmAquatonicCourseApp.timesList.reset()},reset:function(){this.selectedValue=null,TmsmAquatonicCourseApp.selectedData.set("hourminutes",null),this.hide()},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquatonicCourseApp.TimesListItemView=Backbone.View.extend({tagName:"option",attributes:function(){return TmsmAquatonicCourseApp.times_indexmax=Math.max(TmsmAquatonicCourseApp.times_indexmax,this.model.get("index")),{"data-index":this.model.get("index"),"data-hourminutes":this.model.attributes.hourminutes,"data-date":this.model.attributes.date,"data-hour":this.model.attributes.hour,"data-minutes":this.model.attributes.minutes}},className:"tmsm-aquatonic-course-booking-time-item",template:wp.template("tmsm-aquatonic-course-booking-time"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquatonicCourseApp.WeekDayModel=TmsmAquatonicCourseBaseModel.extend({action:"tmsm-aquatonic-course-booking-weekday",defaults:{date_label:null,date_computed:null}}),TmsmAquatonicCourseApp.WeekDayCollection=TmsmAquatonicCourseBaseCollection.extend({action:"tmsm-aquatonic-course-booking-weekday",model:TmsmAquatonicCourseApp.WeekDayModel}),TmsmAquatonicCourseApp.WeekDayListView=Backbone.View.extend({el:"#tmsm-aquatonic-course-slots-container",listElement:"#tmsm-aquatonic-course-booking-weekdays-list",selectButtons:".tmsm-aquatonic-course-booking-time-button",addAppointmentButton:"#tmsm-aquatonic-course-booking-confirm",daysPage:1,timesPage:1,timesPerPage:10,templateHelpers:{moment:moment},initialize:function(){moment.locale(TmsmAquatonicCourseApp.locale),this.listenTo(this.collection,"sync",this.render)},events:{"click .tmsm-aquatonic-course-booking-time-button":"selectTime","change .tmsm-aquatonic-course-booking-weekday-times":"selectTimeWithSelect","click #tmsm-aquatonic-course-booking-weekdays-previous":"previous_week","click #tmsm-aquatonic-course-booking-weekdays-next":"next_week","click #tmsm-aquatonic-course-booking-next-times":"next_times"},refreshNextTimesButton:function(event){},previous_week:function(event){event.preventDefault(),this.daysPage=this.daysPage-1,this.timesPage=1,$("#tmsm-aquatonic-course-booking-next-times").hide(),this.render()},next_week:function(event){event.preventDefault(),this.daysPage=this.daysPage+1,this.timesPage=1,$("#tmsm-aquatonic-course-booking-next-times").hide(),this.render()},next_times:function(event){event.preventDefault(),this.timesPage=this.timesPage+1,this.refreshNextTimesButton()},render:function(){if(2==TmsmAquatonicCourseApp.form_fields.step){var object=this,$list=this.$(this.listElement).empty().val("");this.collection.reset(),1===this.daysPage?$("#tmsm-aquatonic-course-booking-weekdays-previous").attr("disabled",!0):$("#tmsm-aquatonic-course-booking-weekdays-previous").attr("disabled",!1),TmsmAquatonicCourseApp.data.daysrangeto/7<this.daysPage?$("#tmsm-aquatonic-course-booking-weekdays-next").attr("disabled",!0):$("#tmsm-aquatonic-course-booking-weekdays-next").attr("disabled",!1);var i=0;for(TmsmAquatonicCourseApp.times_indexmax=1,$("#tmsm-aquatonic-course-booking-next-times").hide(),i=parseInt(TmsmAquatonicCourseApp.data.daysrangefrom)+7*(this.daysPage-1);i<parseInt(TmsmAquatonicCourseApp.data.daysrangefrom)+7+7*(this.daysPage-1);i++)this.collection.push({date_label:moment().add(i,"days").format("ddddÂ Do MMMM"),date_label_secondline:moment().add(i,"days").format("MMMM"),date_label_firstline:moment().add(i,"days").format("dddd Do"),date_computed:moment().add(i,"days").format("YYYY-MM-DD")});return this.collection.each(function(model){var item=new TmsmAquatonicCourseApp.WeekDayListItemView({model:model});$list.append(item.render().$el),$("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"]").hide().parent().next().show(),TmsmAquatonicCourseApp.times.fetch({data:{date:model.attributes.date_computed,participants:TmsmAquatonicCourseApp.participants},complete:function(xhr){0<$("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"] option:eq(1)").length&&($.trim($("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"] option:eq(1)").text())!=TmsmAquatonicCourseApp.i18n.notimeslot&&$.trim($("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"] option:eq(1)").text())!=TmsmAquatonicCourseApp.i18n.closed||$("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"] option:eq(0)").remove()),$("select.tmsm-aquatonic-course-booking-weekday-times[data-date="+model.attributes.date_computed+"]").selectpicker("refresh").show().parent().next().hide(),object.refreshNextTimesButton()}})},this),this}},selectTimeWithSelect:function(event){event.preventDefault();var date=$(event.target.options[event.target.selectedIndex]).data("date"),hour=$(event.target.options[event.target.selectedIndex]).data("hour"),minutes=$(event.target.options[event.target.selectedIndex]).data("minutes");this.selectedValue=$(event.target.options[event.target.selectedIndex]).data("hourminutes"),TmsmAquatonicCourseApp.selectedData.set("hourminutes",this.selectedValue),TmsmAquatonicCourseApp.selectedData.set("hour",hour),TmsmAquatonicCourseApp.selectedData.set("minutes",minutes),TmsmAquatonicCourseApp.selectedData.set("date",date)},selectTime:function(event){event.preventDefault(),this.selectedValue=$(event.target).data("hourminutes");var date=$(event.target).data("date"),hour=$(event.target).data("hour"),minutes=$(event.target).data("minutes");$(this.selectButtons).removeClass("btn-primary").removeClass("disabled").removeClass("selected").addClass("not-selected"),$(event.target).addClass("btn-primary").addClass("disabled").removeClass("not-selected"),TmsmAquatonicCourseApp.selectedData.set("hourminutes",this.selectedValue),TmsmAquatonicCourseApp.selectedData.set("hour",hour),TmsmAquatonicCourseApp.selectedData.set("minutes",minutes),TmsmAquatonicCourseApp.selectedData.set("date",date)}}),TmsmAquatonicCourseApp.WeekDayListItemView=Backbone.View.extend({tagName:"div",className:"tmsm-aquatonic-course-booking-weekday-item",template:wp.template("tmsm-aquatonic-course-booking-weekday"),initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var html=this.template(this.model.toJSON());return this.$el.html(html),this}}),TmsmAquatonicCourseApp.SelectedDataModel=Backbone.Model.extend({defaults:{date:null,hourminutes:null,hour:null,minutes:null}}),TmsmAquatonicCourseApp.SelectedDataView=Backbone.View.extend({el:"#tmsm-aquatonic-course-booking-confirm-container",cancelButton:"#tmsm-aquatonic-course-booking-cancel",confirmButton:".gform_button[type=submit]",errorElement:"#tmsm-aquatonic-course-booking-confirm-error",initialize:function(){this.hideError(),this.hideConfirm(),this.hideCancel(),this.listenTo(this.model,"change",this.change)},events:{"click #tmsm-aquatonic-course-booking-cancel":"cancel","click #tmsm-aquatonic-course-booking-confirm":"confirm"},cancel:function(event){event.preventDefault(),this.hideError(),TmsmAquatonicCourseApp.selectedData.clear().set({}),TmsmAquatonicCourseApp.dateList.reset(),TmsmAquatonicCourseApp.timesList.reset()},confirm:function(event){event.preventDefault(),$(this.errorElement).empty(),this.showLoading()},change:function(){var day;this.canConfirm(this.model.attributes)?(day=moment(this.model.attributes.date),0<$(TmsmAquatonicCourseApp.form_fields.date_field).length&&$(TmsmAquatonicCourseApp.form_fields.date_field).val(this.model.attributes.date),0<$(TmsmAquatonicCourseApp.form_fields.hour_field).length&&$(TmsmAquatonicCourseApp.form_fields.hour_field).val(this.model.attributes.hour),0<$(TmsmAquatonicCourseApp.form_fields.minutes_field).length&&$(TmsmAquatonicCourseApp.form_fields.minutes_field).val(this.model.attributes.minutes),0<$(TmsmAquatonicCourseApp.form_fields.summary_field).length&&$(TmsmAquatonicCourseApp.form_fields.summary_field).html(sprintf(TmsmAquatonicCourseApp.i18n.summary,TmsmAquatonicCourseApp.participants,day.format("dddd DD MMMM YYYY"),this.model.attributes.hour,this.model.attributes.minutes)),this.showConfirm()):this.hideConfirm()},showLoading:function(){$(this.confirmButton).prop("disabled",!0).addClass("btn-disabled")},hideLoading:function(){$(this.confirmButton).prop("disabled",!1).removeClass("btn-disabled")},showError:function(){$(this.errorElement).show()},hideError:function(){$(this.errorElement).hide()},showConfirm:function(){TmsmAquatonicCourseApp.animateTransition($(TmsmAquatonicCourseApp.form_fields.summary_field)),$(this.confirmButton).show()},hideConfirm:function(){$(this.confirmButton).hide()},showCancel:function(){$(this.cancelButton).show()},hideCancel:function(){$(this.cancelButton).hide()},canConfirm:function(attributes){return null!=attributes.date&&null!=attributes.hour&&null!=attributes.minutes},render:function(){return this},element:function(){return this.$el},hide:function(){this.$el.hide()},show:function(){this.$el.show()}}),TmsmAquatonicCourseApp.animateTransition=function(element){element.show(),$("html, body").animate({scrollTop:element.offset().top},400)},TmsmAquatonicCourseApp.init=function(){$(".tmsm-aquatonic-course-birthdate input").mask("99/99/9999",{placeholder:TmsmAquatonicCourseApp.i18n.birthdateformat}),0<$(".tmsm-aquatonic-course-participants").length&&(TmsmAquatonicCourseApp.participants=$(".tmsm-aquatonic-course-participants input").val()),TmsmAquatonicCourseApp.times_per_page=10,TmsmAquatonicCourseApp.times_page=1,TmsmAquatonicCourseApp.times_indexmax=1,TmsmAquatonicCourseApp.times=new TmsmAquatonicCourseApp.TimesCollection,TmsmAquatonicCourseApp.times.reset(TmsmAquatonicCourseApp.data.times),TmsmAquatonicCourseApp.timesList=new TmsmAquatonicCourseApp.TimesListView({collection:TmsmAquatonicCourseApp.times}),TmsmAquatonicCourseApp.timesList.render(),TmsmAquatonicCourseApp.weekdays=new TmsmAquatonicCourseApp.WeekDayCollection,TmsmAquatonicCourseApp.weekdays.reset(TmsmAquatonicCourseApp.data.times),TmsmAquatonicCourseApp.weekdaysList=new TmsmAquatonicCourseApp.WeekDayListView({collection:TmsmAquatonicCourseApp.weekdays}),TmsmAquatonicCourseApp.weekdaysList.render(),TmsmAquatonicCourseApp.selectedData=new TmsmAquatonicCourseApp.SelectedDataModel,TmsmAquatonicCourseApp.selectedDataList=new TmsmAquatonicCourseApp.SelectedDataView({model:TmsmAquatonicCourseApp.selectedData}),$(document).bind("gform_post_render",function(event,formId,currentPage){TmsmAquatonicCourseApp.form_fields.step=currentPage,2==TmsmAquatonicCourseApp.form_fields.step&&TmsmAquatonicCourseApp.weekdaysList.render(),0<$(TmsmAquatonicCourseApp.form_fields.summary_field).length&&$(TmsmAquatonicCourseApp.form_fields.summary_field).html("")})},$(document).ready(function(){0<$(".tmsm-aquatonic-course-form-add_wrapper").length&&TmsmAquatonicCourseApp.init()})}(jQuery),document.addEventListener("om.Scripts.init",function(evt){window._omapp.scripts.moment.status="loaded",window._omapp.scripts.moment.object=window.moment||null,window._omapp.scripts.momentTz.status="loaded",window._omapp.scripts.momentTz.object=window.moment?window.moment.tz:null});